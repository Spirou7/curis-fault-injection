import numpy as np

def choose_random_layer(
    model: str,
    phase: str
) -> str:
    """
    Choose a random layer from the model.
    Args:
        model (str): The model name.
        phase (str): The phase of the model.
    Returns:
        layer (str): The random layer.
    """

    resnet18_fwrd_layers = [
            "conv1",
            "basicblock_1_basic_0_conv1",
            "basicblock_1_basic_0_conv2",
            "basicblock_1_basic_1_conv1",
            "basicblock_1_basic_1_conv2",
            "basicblock_2_basic_0_downsample",
            "basicblock_2_basic_0_conv1",
            "basicblock_2_basic_0_conv2",
            "basicblock_2_basic_1_conv1",
            "basicblock_2_basic_1_conv2",
            "basicblock_3_basic_0_downsample",
            "basicblock_3_basic_0_conv1",
            "basicblock_3_basic_0_conv2",
            "basicblock_3_basic_1_conv1",
            "basicblock_3_basic_1_conv2",
            "basicblock_4_basic_0_downsample",
            "basicblock_4_basic_0_conv1",
            "basicblock_4_basic_0_conv2",
            "basicblock_4_basic_1_conv1",
            "basicblock_4_basic_1_conv2"
            ]

    resnet18_bkwd_layers = [
            "basicblock_4_basic_1_conv2_grad_in",
            "basicblock_4_basic_1_conv2_grad_wt",
            "basicblock_4_basic_1_conv1_grad_in",
            "basicblock_4_basic_1_conv1_grad_wt",
            "basicblock_4_basic_0_downsample_grad_in",
            "basicblock_4_basic_0_downsample_grad_wt",
            "basicblock_4_basic_0_conv2_grad_in",
            "basicblock_4_basic_0_conv2_grad_wt",
            "basicblock_4_basic_0_conv1_grad_in",
            "basicblock_4_basic_0_conv1_grad_wt",
            "basicblock_3_basic_1_conv2_grad_in",
            "basicblock_3_basic_1_conv2_grad_wt",
            "basicblock_3_basic_1_conv1_grad_in",
            "basicblock_3_basic_1_conv1_grad_wt",
            "basicblock_3_basic_0_downsample_grad_in",
            "basicblock_3_basic_0_downsample_grad_wt",
            "basicblock_3_basic_0_conv2_grad_in",
            "basicblock_3_basic_0_conv2_grad_wt",
            "basicblock_3_basic_0_conv1_grad_in",
            "basicblock_3_basic_0_conv1_grad_wt",
            "basicblock_2_basic_1_conv2_grad_in",
            "basicblock_2_basic_1_conv2_grad_wt",
            "basicblock_2_basic_1_conv1_grad_in",
            "basicblock_2_basic_1_conv1_grad_wt",
            "basicblock_2_basic_0_downsample_grad_in",
            "basicblock_2_basic_0_downsample_grad_wt",
            "basicblock_2_basic_0_conv2_grad_in",
            "basicblock_2_basic_0_conv2_grad_wt",
            "basicblock_2_basic_0_conv1_grad_in",
            "basicblock_2_basic_0_conv1_grad_wt",
            "basicblock_1_basic_1_conv2_grad_in",
            "basicblock_1_basic_1_conv2_grad_wt",
            "basicblock_1_basic_1_conv1_grad_in",
            "basicblock_1_basic_1_conv1_grad_wt",
            "basicblock_1_basic_0_conv2_grad_in",
            "basicblock_1_basic_0_conv2_grad_wt",
            "basicblock_1_basic_0_conv1_grad_in",
            "basicblock_1_basic_0_conv1_grad_wt",
            "conv1_grad_in",
            "conv1_grad_wt"
            ]

    effnet_fwrd_layers = [
            "conv2",
            "block7_mbconv_0_conv2",
            "block7_mbconv_0_se_expand_conv",
            "block7_mbconv_0_se_reduce_conv",
            "block7_mbconv_0_conv1",
            "block6_mbconv_3_conv2",
            "block6_mbconv_3_se_expand_conv",
            "block6_mbconv_3_se_reduce_conv",
            "block6_mbconv_3_conv1",
            "block6_mbconv_2_conv2",
            "block6_mbconv_2_se_expand_conv",
            "block6_mbconv_2_se_reduce_conv",
            "block6_mbconv_2_conv1",
            "block6_mbconv_1_conv2",
            "block6_mbconv_1_se_expand_conv",
            "block6_mbconv_1_se_reduce_conv",
            "block6_mbconv_1_conv1",
            "block6_mbconv_0_conv2",
            "block6_mbconv_0_se_expand_conv",
            "block6_mbconv_0_se_reduce_conv",
            "block6_mbconv_0_conv1",
            "block5_mbconv_2_conv2",
            "block5_mbconv_2_se_expand_conv",
            "block5_mbconv_2_se_reduce_conv",
            "block5_mbconv_2_conv1",
            "block5_mbconv_1_conv2",
            "block5_mbconv_1_se_expand_conv",
            "block5_mbconv_1_se_reduce_conv",
            "block5_mbconv_1_conv1",
            "block5_mbconv_0_conv2",
            "block5_mbconv_0_se_expand_conv",
            "block5_mbconv_0_se_reduce_conv",
            "block5_mbconv_0_conv1",
            "block4_mbconv_2_conv2",
            "block4_mbconv_2_se_expand_conv",
            "block4_mbconv_2_se_reduce_conv",
            "block4_mbconv_2_conv1",
            "block4_mbconv_1_conv2",
            "block4_mbconv_1_se_expand_conv",
            "block4_mbconv_1_se_reduce_conv",
            "block4_mbconv_1_conv1",
            "block4_mbconv_0_conv2",
            "block4_mbconv_0_se_expand_conv",
            "block4_mbconv_0_se_reduce_conv",
            "block4_mbconv_0_conv1",
            "block3_mbconv_1_conv2",
            "block3_mbconv_1_se_expand_conv",
            "block3_mbconv_1_se_reduce_conv",
            "block3_mbconv_1_conv1",
            "block3_mbconv_0_conv2",
            "block3_mbconv_0_se_expand_conv",
            "block3_mbconv_0_se_reduce_conv",
            "block3_mbconv_0_conv1",
            "block2_mbconv_1_conv2",
            "block2_mbconv_1_se_expand_conv",
            "block2_mbconv_1_se_reduce_conv",
            "block2_mbconv_1_conv1",
            "block2_mbconv_0_conv2",
            "block2_mbconv_0_se_expand_conv",
            "block2_mbconv_0_se_reduce_conv",
            "block2_mbconv_0_conv1",
            "block1_mbconv_0_conv2",
            "block1_mbconv_0_se_expand_conv",
            "block1_mbconv_0_se_reduce_conv",
            "block1_mbconv_0_conv1",
            "conv1"
    ]

    effnet_bkwd_layers = [
            "conv2_grad_in",
            "block7_mbconv_0_conv2_grad_in",
            "block7_mbconv_0_se_expand_conv_grad_in",
            "block7_mbconv_0_se_reduce_conv_grad_in",
            "block7_mbconv_0_conv1_grad_in",
            "block6_mbconv_3_conv2_grad_in",
            "block6_mbconv_3_se_expand_conv_grad_in",
            "block6_mbconv_3_se_reduce_conv_grad_in",
            "block6_mbconv_3_conv1_grad_in",
            "block6_mbconv_2_conv2_grad_in",
            "block6_mbconv_2_se_expand_conv_grad_in",
            "block6_mbconv_2_se_reduce_conv_grad_in",
            "block6_mbconv_2_conv1_grad_in",
            "block6_mbconv_1_conv2_grad_in",
            "block6_mbconv_1_se_expand_conv_grad_in",
            "block6_mbconv_1_se_reduce_conv_grad_in",
            "block6_mbconv_1_conv1_grad_in",
            "block6_mbconv_0_conv2_grad_in",
            "block6_mbconv_0_se_expand_conv_grad_in",
            "block6_mbconv_0_se_reduce_conv_grad_in",
            "block6_mbconv_0_conv1_grad_in",
            "block5_mbconv_2_conv2_grad_in",
            "block5_mbconv_2_se_expand_conv_grad_in",
            "block5_mbconv_2_se_reduce_conv_grad_in",
            "block5_mbconv_2_conv1_grad_in",
            "block5_mbconv_1_conv2_grad_in",
            "block5_mbconv_1_se_expand_conv_grad_in",
            "block5_mbconv_1_se_reduce_conv_grad_in",
            "block5_mbconv_1_conv1_grad_in",
            "block5_mbconv_0_conv2_grad_in",
            "block5_mbconv_0_se_expand_conv_grad_in",
            "block5_mbconv_0_se_reduce_conv_grad_in",
            "block5_mbconv_0_conv1_grad_in",
            "block4_mbconv_2_conv2_grad_in",
            "block4_mbconv_2_se_expand_conv_grad_in",
            "block4_mbconv_2_se_reduce_conv_grad_in",
            "block4_mbconv_2_conv1_grad_in",
            "block4_mbconv_1_conv2_grad_in",
            "block4_mbconv_1_se_expand_conv_grad_in",
            "block4_mbconv_1_se_reduce_conv_grad_in",
            "block4_mbconv_1_conv1_grad_in",
            "block4_mbconv_0_conv2_grad_in",
            "block4_mbconv_0_se_expand_conv_grad_in",
            "block4_mbconv_0_se_reduce_conv_grad_in",
            "block4_mbconv_0_conv1_grad_in",
            "block3_mbconv_1_conv2_grad_in",
            "block3_mbconv_1_se_expand_conv_grad_in",
            "block3_mbconv_1_se_reduce_conv_grad_in",
            "block3_mbconv_1_conv1_grad_in",
            "block3_mbconv_0_conv2_grad_in",
            "block3_mbconv_0_se_expand_conv_grad_in",
            "block3_mbconv_0_se_reduce_conv_grad_in",
            "block3_mbconv_0_conv1_grad_in",
            "block2_mbconv_1_conv2_grad_in",
            "block2_mbconv_1_se_expand_conv_grad_in",
            "block2_mbconv_1_se_reduce_conv_grad_in",
            "block2_mbconv_1_conv1_grad_in",
            "block2_mbconv_0_conv2_grad_in",
            "block2_mbconv_0_se_expand_conv_grad_in",
            "block2_mbconv_0_se_reduce_conv_grad_in",
            "block2_mbconv_0_conv1_grad_in",
            "block1_mbconv_0_conv2_grad_in",
            "block1_mbconv_0_se_expand_conv_grad_in",
            "block1_mbconv_0_se_reduce_conv_grad_in",
            "block1_mbconv_0_conv1_grad_in",
            "conv1_grad_in",

            "conv2_grad_wt",
            "block7_mbconv_0_conv2_grad_wt",
            "block7_mbconv_0_se_expand_conv_grad_wt",
            "block7_mbconv_0_se_reduce_conv_grad_wt",
            "block7_mbconv_0_conv1_grad_wt",
            "block6_mbconv_3_conv2_grad_wt",
            "block6_mbconv_3_se_expand_conv_grad_wt",
            "block6_mbconv_3_se_reduce_conv_grad_wt",
            "block6_mbconv_3_conv1_grad_wt",
            "block6_mbconv_2_conv2_grad_wt",
            "block6_mbconv_2_se_expand_conv_grad_wt",
            "block6_mbconv_2_se_reduce_conv_grad_wt",
            "block6_mbconv_2_conv1_grad_wt",
            "block6_mbconv_1_conv2_grad_wt",
            "block6_mbconv_1_se_expand_conv_grad_wt",
            "block6_mbconv_1_se_reduce_conv_grad_wt",
            "block6_mbconv_1_conv1_grad_wt",
            "block6_mbconv_0_conv2_grad_wt",
            "block6_mbconv_0_se_expand_conv_grad_wt",
            "block6_mbconv_0_se_reduce_conv_grad_wt",
            "block6_mbconv_0_conv1_grad_wt",
            "block5_mbconv_2_conv2_grad_wt",
            "block5_mbconv_2_se_expand_conv_grad_wt",
            "block5_mbconv_2_se_reduce_conv_grad_wt",
            "block5_mbconv_2_conv1_grad_wt",
            "block5_mbconv_1_conv2_grad_wt",
            "block5_mbconv_1_se_expand_conv_grad_wt",
            "block5_mbconv_1_se_reduce_conv_grad_wt",
            "block5_mbconv_1_conv1_grad_wt",
            "block5_mbconv_0_conv2_grad_wt",
            "block5_mbconv_0_se_expand_conv_grad_wt",
            "block5_mbconv_0_se_reduce_conv_grad_wt",
            "block5_mbconv_0_conv1_grad_wt",
            "block4_mbconv_2_conv2_grad_wt",
            "block4_mbconv_2_se_expand_conv_grad_wt",
            "block4_mbconv_2_se_reduce_conv_grad_wt",
            "block4_mbconv_2_conv1_grad_wt",
            "block4_mbconv_1_conv2_grad_wt",
            "block4_mbconv_1_se_expand_conv_grad_wt",
            "block4_mbconv_1_se_reduce_conv_grad_wt",
            "block4_mbconv_1_conv1_grad_wt",
            "block4_mbconv_0_conv2_grad_wt",
            "block4_mbconv_0_se_expand_conv_grad_wt",
            "block4_mbconv_0_se_reduce_conv_grad_wt",
            "block4_mbconv_0_conv1_grad_wt",
            "block3_mbconv_1_conv2_grad_wt",
            "block3_mbconv_1_se_expand_conv_grad_wt",
            "block3_mbconv_1_se_reduce_conv_grad_wt",
            "block3_mbconv_1_conv1_grad_wt",
            "block3_mbconv_0_conv2_grad_wt",
            "block3_mbconv_0_se_expand_conv_grad_wt",
            "block3_mbconv_0_se_reduce_conv_grad_wt",
            "block3_mbconv_0_conv1_grad_wt",
            "block2_mbconv_1_conv2_grad_wt",
            "block2_mbconv_1_se_expand_conv_grad_wt",
            "block2_mbconv_1_se_reduce_conv_grad_wt",
            "block2_mbconv_1_conv1_grad_wt",
            "block2_mbconv_0_conv2_grad_wt",
            "block2_mbconv_0_se_expand_conv_grad_wt",
            "block2_mbconv_0_se_reduce_conv_grad_wt",
            "block2_mbconv_0_conv1_grad_wt",
            "block1_mbconv_0_conv2_grad_wt",
            "block1_mbconv_0_se_expand_conv_grad_wt",
            "block1_mbconv_0_se_reduce_conv_grad_wt",
            "block1_mbconv_0_conv1_grad_wt",
            "conv1_grad_wt"
    ]

    densenet_fwrd_layers = [
            "densenet_conv",
            "densenet_dense_block_1_bottleneck_0_conv1",
            "densenet_dense_block_1_bottleneck_0_conv2",
            "densenet_dense_block_1_bottleneck_1_conv1",
            "densenet_dense_block_1_bottleneck_1_conv2",
            "densenet_dense_block_1_bottleneck_2_conv1",
            "densenet_dense_block_1_bottleneck_2_conv2",
            "densenet_dense_block_1_bottleneck_3_conv1",
            "densenet_dense_block_1_bottleneck_3_conv2",
            "densenet_dense_block_1_bottleneck_4_conv1",
            "densenet_dense_block_1_bottleneck_4_conv2",
            "densenet_dense_block_1_bottleneck_5_conv1",
            "densenet_dense_block_1_bottleneck_5_conv2",
            "densenet_transition_1_conv",
            "densenet_dense_block_2_bottleneck_0_conv1",
            "densenet_dense_block_2_bottleneck_0_conv2",
            "densenet_dense_block_2_bottleneck_1_conv1",
            "densenet_dense_block_2_bottleneck_1_conv2",
            "densenet_dense_block_2_bottleneck_2_conv1",
            "densenet_dense_block_2_bottleneck_2_conv2",
            "densenet_dense_block_2_bottleneck_3_conv1",
            "densenet_dense_block_2_bottleneck_3_conv2",
            "densenet_dense_block_2_bottleneck_4_conv1",
            "densenet_dense_block_2_bottleneck_4_conv2",
            "densenet_dense_block_2_bottleneck_5_conv1",
            "densenet_dense_block_2_bottleneck_5_conv2",
            "densenet_dense_block_2_bottleneck_6_conv1",
            "densenet_dense_block_2_bottleneck_6_conv2",
            "densenet_dense_block_2_bottleneck_7_conv1",
            "densenet_dense_block_2_bottleneck_7_conv2",
            "densenet_dense_block_2_bottleneck_8_conv1",
            "densenet_dense_block_2_bottleneck_8_conv2",
            "densenet_dense_block_2_bottleneck_9_conv1",
            "densenet_dense_block_2_bottleneck_9_conv2",
            "densenet_dense_block_2_bottleneck_10_conv1",
            "densenet_dense_block_2_bottleneck_10_conv2",
            "densenet_dense_block_2_bottleneck_11_conv1",
            "densenet_dense_block_2_bottleneck_11_conv2",
            "densenet_transition_2_conv",
            "densenet_dense_block_3_bottleneck_0_conv1",
            "densenet_dense_block_3_bottleneck_0_conv2",
            "densenet_dense_block_3_bottleneck_1_conv1",
            "densenet_dense_block_3_bottleneck_1_conv2",
            "densenet_dense_block_3_bottleneck_2_conv1",
            "densenet_dense_block_3_bottleneck_2_conv2",
            "densenet_dense_block_3_bottleneck_3_conv1",
            "densenet_dense_block_3_bottleneck_3_conv2",
            "densenet_dense_block_3_bottleneck_4_conv1",
            "densenet_dense_block_3_bottleneck_4_conv2",
            "densenet_dense_block_3_bottleneck_5_conv1",
            "densenet_dense_block_3_bottleneck_5_conv2",
            "densenet_dense_block_3_bottleneck_6_conv1",
            "densenet_dense_block_3_bottleneck_6_conv2",
            "densenet_dense_block_3_bottleneck_7_conv1",
            "densenet_dense_block_3_bottleneck_7_conv2",
            "densenet_dense_block_3_bottleneck_8_conv1",
            "densenet_dense_block_3_bottleneck_8_conv2",
            "densenet_dense_block_3_bottleneck_9_conv1",
            "densenet_dense_block_3_bottleneck_9_conv2",
            "densenet_dense_block_3_bottleneck_10_conv1",
            "densenet_dense_block_3_bottleneck_10_conv2",
            "densenet_dense_block_3_bottleneck_11_conv1",
            "densenet_dense_block_3_bottleneck_11_conv2",
            "densenet_dense_block_3_bottleneck_12_conv1",
            "densenet_dense_block_3_bottleneck_12_conv2",
            "densenet_dense_block_3_bottleneck_13_conv1",
            "densenet_dense_block_3_bottleneck_13_conv2",
            "densenet_dense_block_3_bottleneck_14_conv1",
            "densenet_dense_block_3_bottleneck_14_conv2",
            "densenet_dense_block_3_bottleneck_15_conv1",
            "densenet_dense_block_3_bottleneck_15_conv2",
            "densenet_dense_block_3_bottleneck_16_conv1",
            "densenet_dense_block_3_bottleneck_16_conv2",
            "densenet_dense_block_3_bottleneck_17_conv1",
            "densenet_dense_block_3_bottleneck_17_conv2",
            "densenet_dense_block_3_bottleneck_18_conv1",
            "densenet_dense_block_3_bottleneck_18_conv2",
            "densenet_dense_block_3_bottleneck_19_conv1",
            "densenet_dense_block_3_bottleneck_19_conv2",
            "densenet_dense_block_3_bottleneck_20_conv1",
            "densenet_dense_block_3_bottleneck_20_conv2",
            "densenet_dense_block_3_bottleneck_21_conv1",
            "densenet_dense_block_3_bottleneck_21_conv2",
            "densenet_dense_block_3_bottleneck_22_conv1",
            "densenet_dense_block_3_bottleneck_22_conv2",
            "densenet_dense_block_3_bottleneck_23_conv1",
            "densenet_dense_block_3_bottleneck_23_conv2",
            "densenet_transition_3_conv",
            "densenet_dense_block_4_bottleneck_0_conv1",
            "densenet_dense_block_4_bottleneck_0_conv2",
            "densenet_dense_block_4_bottleneck_1_conv1",
            "densenet_dense_block_4_bottleneck_1_conv2",
            "densenet_dense_block_4_bottleneck_2_conv1",
            "densenet_dense_block_4_bottleneck_2_conv2",
            "densenet_dense_block_4_bottleneck_3_conv1",
            "densenet_dense_block_4_bottleneck_3_conv2",
            "densenet_dense_block_4_bottleneck_4_conv1",
            "densenet_dense_block_4_bottleneck_4_conv2",
            "densenet_dense_block_4_bottleneck_5_conv1",
            "densenet_dense_block_4_bottleneck_5_conv2",
            "densenet_dense_block_4_bottleneck_6_conv1",
            "densenet_dense_block_4_bottleneck_6_conv2",
            "densenet_dense_block_4_bottleneck_7_conv1",
            "densenet_dense_block_4_bottleneck_7_conv2",
            "densenet_dense_block_4_bottleneck_8_conv1",
            "densenet_dense_block_4_bottleneck_8_conv2",
            "densenet_dense_block_4_bottleneck_9_conv1",
            "densenet_dense_block_4_bottleneck_9_conv2",
            "densenet_dense_block_4_bottleneck_10_conv1",
            "densenet_dense_block_4_bottleneck_10_conv2",
            "densenet_dense_block_4_bottleneck_11_conv1",
            "densenet_dense_block_4_bottleneck_11_conv2",
            "densenet_dense_block_4_bottleneck_12_conv1",
            "densenet_dense_block_4_bottleneck_12_conv2",
            "densenet_dense_block_4_bottleneck_13_conv1",
            "densenet_dense_block_4_bottleneck_13_conv2",
            "densenet_dense_block_4_bottleneck_14_conv1",
            "densenet_dense_block_4_bottleneck_14_conv2",
            "densenet_dense_block_4_bottleneck_15_conv1",
            "densenet_dense_block_4_bottleneck_15_conv2"
    ]

    densenet_bkwd_layers = [
            "densenet_conv_grad_in",
            "densenet_dense_block_1_bottleneck_0_conv1_grad_in",
            "densenet_dense_block_1_bottleneck_0_conv2_grad_in",
            "densenet_dense_block_1_bottleneck_1_conv1_grad_in",
            "densenet_dense_block_1_bottleneck_1_conv2_grad_in",
            "densenet_dense_block_1_bottleneck_2_conv1_grad_in",
            "densenet_dense_block_1_bottleneck_2_conv2_grad_in",
            "densenet_dense_block_1_bottleneck_3_conv1_grad_in",
            "densenet_dense_block_1_bottleneck_3_conv2_grad_in",
            "densenet_dense_block_1_bottleneck_4_conv1_grad_in",
            "densenet_dense_block_1_bottleneck_4_conv2_grad_in",
            "densenet_dense_block_1_bottleneck_5_conv1_grad_in",
            "densenet_dense_block_1_bottleneck_5_conv2_grad_in",
            "densenet_transition_1_conv_grad_in",
            "densenet_dense_block_2_bottleneck_0_conv1_grad_in",
            "densenet_dense_block_2_bottleneck_0_conv2_grad_in",
            "densenet_dense_block_2_bottleneck_1_conv1_grad_in",
            "densenet_dense_block_2_bottleneck_1_conv2_grad_in",
            "densenet_dense_block_2_bottleneck_2_conv1_grad_in",
            "densenet_dense_block_2_bottleneck_2_conv2_grad_in",
            "densenet_dense_block_2_bottleneck_3_conv1_grad_in",
            "densenet_dense_block_2_bottleneck_3_conv2_grad_in",
            "densenet_dense_block_2_bottleneck_4_conv1_grad_in",
            "densenet_dense_block_2_bottleneck_4_conv2_grad_in",
            "densenet_dense_block_2_bottleneck_5_conv1_grad_in",
            "densenet_dense_block_2_bottleneck_5_conv2_grad_in",
            "densenet_dense_block_2_bottleneck_6_conv1_grad_in",
            "densenet_dense_block_2_bottleneck_6_conv2_grad_in",
            "densenet_dense_block_2_bottleneck_7_conv1_grad_in",
            "densenet_dense_block_2_bottleneck_7_conv2_grad_in",
            "densenet_dense_block_2_bottleneck_8_conv1_grad_in",
            "densenet_dense_block_2_bottleneck_8_conv2_grad_in",
            "densenet_dense_block_2_bottleneck_9_conv1_grad_in",
            "densenet_dense_block_2_bottleneck_9_conv2_grad_in",
            "densenet_dense_block_2_bottleneck_10_conv1_grad_in",
            "densenet_dense_block_2_bottleneck_10_conv2_grad_in",
            "densenet_dense_block_2_bottleneck_11_conv1_grad_in",
            "densenet_dense_block_2_bottleneck_11_conv2_grad_in",
            "densenet_transition_2_conv_grad_in",
            "densenet_dense_block_3_bottleneck_0_conv1_grad_in",
            "densenet_dense_block_3_bottleneck_0_conv2_grad_in",
            "densenet_dense_block_3_bottleneck_1_conv1_grad_in",
            "densenet_dense_block_3_bottleneck_1_conv2_grad_in",
            "densenet_dense_block_3_bottleneck_2_conv1_grad_in",
            "densenet_dense_block_3_bottleneck_2_conv2_grad_in",
            "densenet_dense_block_3_bottleneck_3_conv1_grad_in",
            "densenet_dense_block_3_bottleneck_3_conv2_grad_in",
            "densenet_dense_block_3_bottleneck_4_conv1_grad_in",
            "densenet_dense_block_3_bottleneck_4_conv2_grad_in",
            "densenet_dense_block_3_bottleneck_5_conv1_grad_in",
            "densenet_dense_block_3_bottleneck_5_conv2_grad_in",
            "densenet_dense_block_3_bottleneck_6_conv1_grad_in",
            "densenet_dense_block_3_bottleneck_6_conv2_grad_in",
            "densenet_dense_block_3_bottleneck_7_conv1_grad_in",
            "densenet_dense_block_3_bottleneck_7_conv2_grad_in",
            "densenet_dense_block_3_bottleneck_8_conv1_grad_in",
            "densenet_dense_block_3_bottleneck_8_conv2_grad_in",
            "densenet_dense_block_3_bottleneck_9_conv1_grad_in",
            "densenet_dense_block_3_bottleneck_9_conv2_grad_in",
            "densenet_dense_block_3_bottleneck_10_conv1_grad_in",
            "densenet_dense_block_3_bottleneck_10_conv2_grad_in",
            "densenet_dense_block_3_bottleneck_11_conv1_grad_in",
            "densenet_dense_block_3_bottleneck_11_conv2_grad_in",
            "densenet_dense_block_3_bottleneck_12_conv1_grad_in",
            "densenet_dense_block_3_bottleneck_12_conv2_grad_in",
            "densenet_dense_block_3_bottleneck_13_conv1_grad_in",
            "densenet_dense_block_3_bottleneck_13_conv2_grad_in",
            "densenet_dense_block_3_bottleneck_14_conv1_grad_in",
            "densenet_dense_block_3_bottleneck_14_conv2_grad_in",
            "densenet_dense_block_3_bottleneck_15_conv1_grad_in",
            "densenet_dense_block_3_bottleneck_15_conv2_grad_in",
            "densenet_dense_block_3_bottleneck_16_conv1_grad_in",
            "densenet_dense_block_3_bottleneck_16_conv2_grad_in",
            "densenet_dense_block_3_bottleneck_17_conv1_grad_in",
            "densenet_dense_block_3_bottleneck_17_conv2_grad_in",
            "densenet_dense_block_3_bottleneck_18_conv1_grad_in",
            "densenet_dense_block_3_bottleneck_18_conv2_grad_in",
            "densenet_dense_block_3_bottleneck_19_conv1_grad_in",
            "densenet_dense_block_3_bottleneck_19_conv2_grad_in",
            "densenet_dense_block_3_bottleneck_20_conv1_grad_in",
            "densenet_dense_block_3_bottleneck_20_conv2_grad_in",
            "densenet_dense_block_3_bottleneck_21_conv1_grad_in",
            "densenet_dense_block_3_bottleneck_21_conv2_grad_in",
            "densenet_dense_block_3_bottleneck_22_conv1_grad_in",
            "densenet_dense_block_3_bottleneck_22_conv2_grad_in",
            "densenet_dense_block_3_bottleneck_23_conv1_grad_in",
            "densenet_dense_block_3_bottleneck_23_conv2_grad_in",
            "densenet_transition_3_conv_grad_in",
            "densenet_dense_block_4_bottleneck_0_conv1_grad_in",
            "densenet_dense_block_4_bottleneck_0_conv2_grad_in",
            "densenet_dense_block_4_bottleneck_1_conv1_grad_in",
            "densenet_dense_block_4_bottleneck_1_conv2_grad_in",
            "densenet_dense_block_4_bottleneck_2_conv1_grad_in",
            "densenet_dense_block_4_bottleneck_2_conv2_grad_in",
            "densenet_dense_block_4_bottleneck_3_conv1_grad_in",
            "densenet_dense_block_4_bottleneck_3_conv2_grad_in",
            "densenet_dense_block_4_bottleneck_4_conv1_grad_in",
            "densenet_dense_block_4_bottleneck_4_conv2_grad_in",
            "densenet_dense_block_4_bottleneck_5_conv1_grad_in",
            "densenet_dense_block_4_bottleneck_5_conv2_grad_in",
            "densenet_dense_block_4_bottleneck_6_conv1_grad_in",
            "densenet_dense_block_4_bottleneck_6_conv2_grad_in",
            "densenet_dense_block_4_bottleneck_7_conv1_grad_in",
            "densenet_dense_block_4_bottleneck_7_conv2_grad_in",
            "densenet_dense_block_4_bottleneck_8_conv1_grad_in",
            "densenet_dense_block_4_bottleneck_8_conv2_grad_in",
            "densenet_dense_block_4_bottleneck_9_conv1_grad_in",
            "densenet_dense_block_4_bottleneck_9_conv2_grad_in",
            "densenet_dense_block_4_bottleneck_10_conv1_grad_in",
            "densenet_dense_block_4_bottleneck_10_conv2_grad_in",
            "densenet_dense_block_4_bottleneck_11_conv1_grad_in",
            "densenet_dense_block_4_bottleneck_11_conv2_grad_in",
            "densenet_dense_block_4_bottleneck_12_conv1_grad_in",
            "densenet_dense_block_4_bottleneck_12_conv2_grad_in",
            "densenet_dense_block_4_bottleneck_13_conv1_grad_in",
            "densenet_dense_block_4_bottleneck_13_conv2_grad_in",
            "densenet_dense_block_4_bottleneck_14_conv1_grad_in",
            "densenet_dense_block_4_bottleneck_14_conv2_grad_in",
            "densenet_dense_block_4_bottleneck_15_conv1_grad_in",
            "densenet_dense_block_4_bottleneck_15_conv2_grad_in", 

            "densenet_conv_grad_wt",
            "densenet_dense_block_1_bottleneck_0_conv1_grad_wt",
            "densenet_dense_block_1_bottleneck_0_conv2_grad_wt",
            "densenet_dense_block_1_bottleneck_1_conv1_grad_wt",
            "densenet_dense_block_1_bottleneck_1_conv2_grad_wt",
            "densenet_dense_block_1_bottleneck_2_conv1_grad_wt",
            "densenet_dense_block_1_bottleneck_2_conv2_grad_wt",
            "densenet_dense_block_1_bottleneck_3_conv1_grad_wt",
            "densenet_dense_block_1_bottleneck_3_conv2_grad_wt",
            "densenet_dense_block_1_bottleneck_4_conv1_grad_wt",
            "densenet_dense_block_1_bottleneck_4_conv2_grad_wt",
            "densenet_dense_block_1_bottleneck_5_conv1_grad_wt",
            "densenet_dense_block_1_bottleneck_5_conv2_grad_wt",
            "densenet_transition_1_conv_grad_wt",
            "densenet_dense_block_2_bottleneck_0_conv1_grad_wt",
            "densenet_dense_block_2_bottleneck_0_conv2_grad_wt",
            "densenet_dense_block_2_bottleneck_1_conv1_grad_wt",
            "densenet_dense_block_2_bottleneck_1_conv2_grad_wt",
            "densenet_dense_block_2_bottleneck_2_conv1_grad_wt",
            "densenet_dense_block_2_bottleneck_2_conv2_grad_wt",
            "densenet_dense_block_2_bottleneck_3_conv1_grad_wt",
            "densenet_dense_block_2_bottleneck_3_conv2_grad_wt",
            "densenet_dense_block_2_bottleneck_4_conv1_grad_wt",
            "densenet_dense_block_2_bottleneck_4_conv2_grad_wt",
            "densenet_dense_block_2_bottleneck_5_conv1_grad_wt",
            "densenet_dense_block_2_bottleneck_5_conv2_grad_wt",
            "densenet_dense_block_2_bottleneck_6_conv1_grad_wt",
            "densenet_dense_block_2_bottleneck_6_conv2_grad_wt",
            "densenet_dense_block_2_bottleneck_7_conv1_grad_wt",
            "densenet_dense_block_2_bottleneck_7_conv2_grad_wt",
            "densenet_dense_block_2_bottleneck_8_conv1_grad_wt",
            "densenet_dense_block_2_bottleneck_8_conv2_grad_wt",
            "densenet_dense_block_2_bottleneck_9_conv1_grad_wt",
            "densenet_dense_block_2_bottleneck_9_conv2_grad_wt",
            "densenet_dense_block_2_bottleneck_10_conv1_grad_wt",
            "densenet_dense_block_2_bottleneck_10_conv2_grad_wt",
            "densenet_dense_block_2_bottleneck_11_conv1_grad_wt",
            "densenet_dense_block_2_bottleneck_11_conv2_grad_wt",
            "densenet_transition_2_conv_grad_wt",
            "densenet_dense_block_3_bottleneck_0_conv1_grad_wt",
            "densenet_dense_block_3_bottleneck_0_conv2_grad_wt",
            "densenet_dense_block_3_bottleneck_1_conv1_grad_wt",
            "densenet_dense_block_3_bottleneck_1_conv2_grad_wt",
            "densenet_dense_block_3_bottleneck_2_conv1_grad_wt",
            "densenet_dense_block_3_bottleneck_2_conv2_grad_wt",
            "densenet_dense_block_3_bottleneck_3_conv1_grad_wt",
            "densenet_dense_block_3_bottleneck_3_conv2_grad_wt",
            "densenet_dense_block_3_bottleneck_4_conv1_grad_wt",
            "densenet_dense_block_3_bottleneck_4_conv2_grad_wt",
            "densenet_dense_block_3_bottleneck_5_conv1_grad_wt",
            "densenet_dense_block_3_bottleneck_5_conv2_grad_wt",
            "densenet_dense_block_3_bottleneck_6_conv1_grad_wt",
            "densenet_dense_block_3_bottleneck_6_conv2_grad_wt",
            "densenet_dense_block_3_bottleneck_7_conv1_grad_wt",
            "densenet_dense_block_3_bottleneck_7_conv2_grad_wt",
            "densenet_dense_block_3_bottleneck_8_conv1_grad_wt",
            "densenet_dense_block_3_bottleneck_8_conv2_grad_wt",
            "densenet_dense_block_3_bottleneck_9_conv1_grad_wt",
            "densenet_dense_block_3_bottleneck_9_conv2_grad_wt",
            "densenet_dense_block_3_bottleneck_10_conv1_grad_wt",
            "densenet_dense_block_3_bottleneck_10_conv2_grad_wt",
            "densenet_dense_block_3_bottleneck_11_conv1_grad_wt",
            "densenet_dense_block_3_bottleneck_11_conv2_grad_wt",
            "densenet_dense_block_3_bottleneck_12_conv1_grad_wt",
            "densenet_dense_block_3_bottleneck_12_conv2_grad_wt",
            "densenet_dense_block_3_bottleneck_13_conv1_grad_wt",
            "densenet_dense_block_3_bottleneck_13_conv2_grad_wt",
            "densenet_dense_block_3_bottleneck_14_conv1_grad_wt",
            "densenet_dense_block_3_bottleneck_14_conv2_grad_wt",
            "densenet_dense_block_3_bottleneck_15_conv1_grad_wt",
            "densenet_dense_block_3_bottleneck_15_conv2_grad_wt",
            "densenet_dense_block_3_bottleneck_16_conv1_grad_wt",
            "densenet_dense_block_3_bottleneck_16_conv2_grad_wt",
            "densenet_dense_block_3_bottleneck_17_conv1_grad_wt",
            "densenet_dense_block_3_bottleneck_17_conv2_grad_wt",
            "densenet_dense_block_3_bottleneck_18_conv1_grad_wt",
            "densenet_dense_block_3_bottleneck_18_conv2_grad_wt",
            "densenet_dense_block_3_bottleneck_19_conv1_grad_wt",
            "densenet_dense_block_3_bottleneck_19_conv2_grad_wt",
            "densenet_dense_block_3_bottleneck_20_conv1_grad_wt",
            "densenet_dense_block_3_bottleneck_20_conv2_grad_wt",
            "densenet_dense_block_3_bottleneck_21_conv1_grad_wt",
            "densenet_dense_block_3_bottleneck_21_conv2_grad_wt",
            "densenet_dense_block_3_bottleneck_22_conv1_grad_wt",
            "densenet_dense_block_3_bottleneck_22_conv2_grad_wt",
            "densenet_dense_block_3_bottleneck_23_conv1_grad_wt",
            "densenet_dense_block_3_bottleneck_23_conv2_grad_wt",
            "densenet_transition_3_conv_grad_wt",
            "densenet_dense_block_4_bottleneck_0_conv1_grad_wt",
            "densenet_dense_block_4_bottleneck_0_conv2_grad_wt",
            "densenet_dense_block_4_bottleneck_1_conv1_grad_wt",
            "densenet_dense_block_4_bottleneck_1_conv2_grad_wt",
            "densenet_dense_block_4_bottleneck_2_conv1_grad_wt",
            "densenet_dense_block_4_bottleneck_2_conv2_grad_wt",
            "densenet_dense_block_4_bottleneck_3_conv1_grad_wt",
            "densenet_dense_block_4_bottleneck_3_conv2_grad_wt",
            "densenet_dense_block_4_bottleneck_4_conv1_grad_wt",
            "densenet_dense_block_4_bottleneck_4_conv2_grad_wt",
            "densenet_dense_block_4_bottleneck_5_conv1_grad_wt",
            "densenet_dense_block_4_bottleneck_5_conv2_grad_wt",
            "densenet_dense_block_4_bottleneck_6_conv1_grad_wt",
            "densenet_dense_block_4_bottleneck_6_conv2_grad_wt",
            "densenet_dense_block_4_bottleneck_7_conv1_grad_wt",
            "densenet_dense_block_4_bottleneck_7_conv2_grad_wt",
            "densenet_dense_block_4_bottleneck_8_conv1_grad_wt",
            "densenet_dense_block_4_bottleneck_8_conv2_grad_wt",
            "densenet_dense_block_4_bottleneck_9_conv1_grad_wt",
            "densenet_dense_block_4_bottleneck_9_conv2_grad_wt",
            "densenet_dense_block_4_bottleneck_10_conv1_grad_wt",
            "densenet_dense_block_4_bottleneck_10_conv2_grad_wt",
            "densenet_dense_block_4_bottleneck_11_conv1_grad_wt",
            "densenet_dense_block_4_bottleneck_11_conv2_grad_wt",
            "densenet_dense_block_4_bottleneck_12_conv1_grad_wt",
            "densenet_dense_block_4_bottleneck_12_conv2_grad_wt",
            "densenet_dense_block_4_bottleneck_13_conv1_grad_wt",
            "densenet_dense_block_4_bottleneck_13_conv2_grad_wt",
            "densenet_dense_block_4_bottleneck_14_conv1_grad_wt",
            "densenet_dense_block_4_bottleneck_14_conv2_grad_wt",
            "densenet_dense_block_4_bottleneck_15_conv1_grad_wt",
            "densenet_dense_block_4_bottleneck_15_conv2_grad_wt"
    ]

    nfnet_fwrd_layers  = [
            "NF_ResNet_block_0_conv0",
            "NF_ResNet_block_0_conv1",
            "NF_ResNet_block_0_conv2",
            "NF_ResNet_block_0_conv_shortcut",
            "NF_ResNet_block_1_conv0",
            "NF_ResNet_block_1_conv1",
            "NF_ResNet_block_1_conv2",
            "NF_ResNet_block_2_conv0",
            "NF_ResNet_block_2_conv1",
            "NF_ResNet_block_2_conv2",
            "NF_ResNet_block_2_conv_shortcut",
            "NF_ResNet_block_3_conv0",
            "NF_ResNet_block_3_conv1",
            "NF_ResNet_block_3_conv2",
            "NF_ResNet_block_4_conv0",
            "NF_ResNet_block_4_conv1",
            "NF_ResNet_block_4_conv2",
            "NF_ResNet_block_4_conv_shortcut",
            "NF_ResNet_block_5_conv0",
            "NF_ResNet_block_5_conv1",
            "NF_ResNet_block_5_conv2",
            "NF_ResNet_block_6_conv0",
            "NF_ResNet_block_6_conv1",
            "NF_ResNet_block_6_conv2",
            "NF_ResNet_block_6_conv_shortcut",
            "NF_ResNet_block_7_conv0",
            "NF_ResNet_block_7_conv1",
            "NF_ResNet_block_7_conv2"
    ]

    nfnet_bkwd_layers = [
            "NF_ResNet_block_0_conv0_grad_in",
            "NF_ResNet_block_0_conv1_grad_in",
            "NF_ResNet_block_0_conv2_grad_in",
            "NF_ResNet_block_0_conv_shortcut_grad_in",
            "NF_ResNet_block_1_conv0_grad_in",
            "NF_ResNet_block_1_conv1_grad_in",
            "NF_ResNet_block_1_conv2_grad_in",
            "NF_ResNet_block_2_conv0_grad_in",
            "NF_ResNet_block_2_conv1_grad_in",
            "NF_ResNet_block_2_conv2_grad_in",
            "NF_ResNet_block_2_conv_shortcut_grad_in",
            "NF_ResNet_block_3_conv0_grad_in",
            "NF_ResNet_block_3_conv1_grad_in",
            "NF_ResNet_block_3_conv2_grad_in",
            "NF_ResNet_block_4_conv0_grad_in",
            "NF_ResNet_block_4_conv1_grad_in",
            "NF_ResNet_block_4_conv2_grad_in",
            "NF_ResNet_block_4_conv_shortcut_grad_in",
            "NF_ResNet_block_5_conv0_grad_in",
            "NF_ResNet_block_5_conv1_grad_in",
            "NF_ResNet_block_5_conv2_grad_in",
            "NF_ResNet_block_6_conv0_grad_in",
            "NF_ResNet_block_6_conv1_grad_in",
            "NF_ResNet_block_6_conv2_grad_in",
            "NF_ResNet_block_6_conv_shortcut_grad_in",
            "NF_ResNet_block_7_conv0_grad_in",
            "NF_ResNet_block_7_conv1_grad_in",
            "NF_ResNet_block_7_conv2_grad_in",

            "NF_ResNet_block_0_conv0_grad_wt",
            "NF_ResNet_block_0_conv1_grad_wt",
            "NF_ResNet_block_0_conv2_grad_wt",
            "NF_ResNet_block_0_conv_shortcut_grad_wt",
            "NF_ResNet_block_1_conv0_grad_wt",
            "NF_ResNet_block_1_conv1_grad_wt",
            "NF_ResNet_block_1_conv2_grad_wt",
            "NF_ResNet_block_2_conv0_grad_wt",
            "NF_ResNet_block_2_conv1_grad_wt",
            "NF_ResNet_block_2_conv2_grad_wt",
            "NF_ResNet_block_2_conv_shortcut_grad_wt",
            "NF_ResNet_block_3_conv0_grad_wt",
            "NF_ResNet_block_3_conv1_grad_wt",
            "NF_ResNet_block_3_conv2_grad_wt",
            "NF_ResNet_block_4_conv0_grad_wt",
            "NF_ResNet_block_4_conv1_grad_wt",
            "NF_ResNet_block_4_conv2_grad_wt",
            "NF_ResNet_block_4_conv_shortcut_grad_wt",
            "NF_ResNet_block_5_conv0_grad_wt",
            "NF_ResNet_block_5_conv1_grad_wt",
            "NF_ResNet_block_5_conv2_grad_wt",
            "NF_ResNet_block_6_conv0_grad_wt",
            "NF_ResNet_block_6_conv1_grad_wt",
            "NF_ResNet_block_6_conv2_grad_wt",
            "NF_ResNet_block_6_conv_shortcut_grad_wt",
            "NF_ResNet_block_7_conv0_grad_wt",
            "NF_ResNet_block_7_conv1_grad_wt",
            "NF_ResNet_block_7_conv2_grad_wt",
    ]


    table_dict = {'resnet18_fwrd_inject': resnet18_fwrd_layers,
                  'resnet18_bkwd_inject': resnet18_bkwd_layers,

                  'effnet_fwrd_inject': effnet_fwrd_layers,
                  'effnet_bkwd_inject': effnet_bkwd_layers,

                  'densenet_fwrd_inject': densenet_fwrd_layers,
                  'densenet_bkwd_inject': densenet_bkwd_layers,

                  'nfnet_fwrd_inject': nfnet_fwrd_layers,
                  'nfnet_bkwd_inject': nfnet_bkwd_layers
            }
    
    if '_' in model:
        model = model[:model.find('_')]
    target_list = table_dict[model + "_" + phase]

    if 'fwrd' in phase:
        return target_list[np.random.randint(len(target_list))]
    else:
        target_layer = None
        while not target_layer or 'grad_in' not in target_layer:
            target_layer = target_list[np.random.randint(len(target_list))]
        return target_layer
